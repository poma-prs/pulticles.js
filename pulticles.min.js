!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Pulticles=t}}(function(t,e){void 0===e&&(e={}),e=Object.assign({edgeLightUpSpeed:.002,edgeFadeSpeed:.001,edgeLightUpBrightness:.2,edgeLightUpAlphaSpeed:.02,eraseAlpha:.5,trailSize:25,pulseChance:.06,maxPulsesPerSpawn:1,maxPulses:10,minVertexRadius:1,minPulseSpeed:.03/2.25,pulseSpeedVariation:.04/2.25,vertexRadiusVariation:1,spacing:80,bg:[71,125,194],fg:[128,198,255]},e);var i=2*Math.PI,n=window.devicePixelRatio,a=t.getContext("2d"),o=t.getBoundingClientRect(),s=o.width*n,r=o.height*n,l=[],h=!1,d=function(t,e){for(var i=0;i<t;i++)e(i)};function u(t,e,a,o){t.beginPath(),t.arc(e*n,a*n,o*n,0,i),t.closePath()}function p(t,e,i){this.r=t,this.g=e,this.b=i}p.prototype={r:0,g:0,b:0,interpolate:function(t,e){var i=t.r-this.r,n=t.g-this.g,a=t.b-this.b;return new p(this.r+i*e,this.g+n*e,this.b+a*e)},toString:function(){return"rgb("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+")"}};var g,c,f,v,b={bg:new p(e.bg[0],e.bg[1],e.bg[2]),fg:new p(e.fg[0],e.fg[1],e.fg[2])},y=function(t){return b.bg.interpolate(b.fg,t).toString()};function m(t){var n;t.pulses=[],t.pulse=function(i,n){var a=new x(i,n);return a.speed=e.minPulseSpeed+e.pulseSpeedVariation*Math.random(),t.pulses.length<e.maxPulses?(i.lightUp(),t.pulses.push(a),i.diagram.edges.find(function(t){return t.va==i&&t.vb==n||t.vb==i&&t.va==n}).lightUp(),a):null},(n=t).vertices.forEach(function(t){var a,o,s=Math.random();t.diagram=n,t.clockSpeed=.002*Math.random()-.001,t.clock=Math.random()*i,t.originX=t.x,t.originY=t.y,t.clockIntensity=0+0*Math.pow(s,3),t.depth=s,t.radius=e.minVertexRadius+s*e.vertexRadiusVariation,t.color=0,t.colorFadeSpeed=.01,t.blips=[],t.blipSpeed=.04,t.blipRadius=3.5*t.radius+Math.random()*t.radius*1,t.forceStrength=4,t.forces=[],t.neighbors=(a=t,void 0===o&&(o=null),n.edges.filter(function(t){return(t.va==a||t.vb==a)&&t.va!=o&&t.vb!=o}).reduce(function(t,e){return t.concat(e.va,e.vb)},[]).filter(function(t){return t!=a})),t.getRandomNeighbor=function(t){void 0===t&&(t=null);var e=this.neighbors.filter(function(e){return e!=t});if(0==e.length)return null;var i=e[Math.round(Math.random()*(e.length-1))];return i},t.lightUp=function(){this.color=1},t.blip=function(){this.blips.push(1)},t.applyForces=function(){for(var e={x:0,y:0},i=t.forces.length-1;i>=0;i--){var n=t.forces[i],a=Math.pow(n.power,3);e.x+=n.cosAngle*a*n.strength,e.y+=n.sinAngle*a*n.strength,n.update(),n.dead&&t.forces.splice(i,1)}return e},t.update=function(){var t=this;this.color>0&&(this.color-=this.colorFadeSpeed,this.color<0&&(this.color=0)),this.blips=this.blips.map(function(e){return e-=t.blipSpeed}).filter(function(t){return t>0})}}),t.edges.forEach(function(t){t.color=0,t.colorTo=0,t.alpha=0,t.alphaTo=1,t.lightUp=function(){t.colorTo=e.edgeLightUpBrightness,t.color=Math.max(t.color,1e-4),t.alpha=0,t.alphaTo=1},t.update=function(){t.alpha<t.alphaTo&&(t.alpha+=e.edgeLightUpAlphaSpeed),t.alphaTo>0?t.alphaTo-=e.edgeLightUpAlphaSpeed:t.alpha-=e.edgeLightUpAlphaSpeed}}),t.outerVertices=t.vertices.filter(function(e){return e.y<=0||e.y>=t.height||e.x<=0||e.x>=t.width})}function M(t,e){this.angle=t,this.power=1,this.strength=e,this.cosAngle=Math.cos(t),this.sinAngle=Math.sin(t)}function x(t,e){this.origin=t,this.dest=e,this.lastPos=[]}function P(t,i,a,o,s){Math.random()<e.pulseChance&&d(Math.random()*e.maxPulsesPerSpawn,function(e){var i=t.vertices[Math.round(Math.random()*(t.vertices.length-1))],n=i.getRandomNeighbor();if(l.length>0&&(null==n||Math.random()<.1)){if(null==(n=(i=l[Math.round(Math.random()*(l.length-1))]).getRandomNeighbor()))return}else if(null==n)return;if(null!=t.pulse(i,n)){var a=n.x-i.x,o=n.y-i.y;Math.atan2(o,a);Math.PI}}),i.clearRect(0,0,a,o),i.fillStyle=y(0),i.globalAlpha=e.eraseAlpha,i.fillRect(0,0,a,o),i.globalAlpha=1,i.fillStyle=y(.2),i.strokeStyle=y(.15),i.lineCap="round",t.edges.forEach(function(t){t.color<=0||(t.update(),t.alpha<=0||(i.beginPath(),i.moveTo(t.va.x*n,t.va.y*n),i.lineTo(t.vb.x*n,t.vb.y*n),i.strokeStyle=y(t.color),i.globalAlpha=t.alpha,i.lineWidth=1*n,i.stroke()))}),t.pulses.forEach(function(t){t.getPos();if(t.update(s),i.beginPath(),i.moveTo(t.lastPos[0].x*n,t.lastPos[0].y*n),t.lastPos.slice(1).forEach(function(t){i.lineTo(t.x*n,t.y*n)}),i.strokeStyle=y(1),i.globalAlpha=.7,i.lineWidth=1*n,i.stroke(),t.lastPos.length>=2&&!t.dying){i.lineWidth=5*n,i.globalAlpha=.7,i.beginPath();var e=t.lastPos.length-2,a=t.lastPos.length-1;i.moveTo(t.lastPos[e].x*n,t.lastPos[e].y*n),i.lineTo(t.lastPos[a].x*n,t.lastPos[a].y*n),i.strokeStyle=y(1),i.stroke()}}),t.vertices.forEach(function(t){var e,a,o,s,r=t.applyForces();if(t.x=t.originX+r.x,t.y=t.originY+r.y,t.color>0){var l=t.depth;0;var h=y(0+1*Math.min(1,t.color));i.fillStyle=h,i.globalAlpha=1-.35*(1-l),e=i,a=t.x,o=t.y,s=t.radius,u(e,a,o,s),e.fill()}t.blips.forEach(function(e){var a,o,s,r=1-e,l=t.radius+t.blipRadius*Math.pow(r,.5),h=1*e;i.globalAlpha=h,i.lineWidth=1*n,i.strokeStyle=y(1),a=i,o=t.x,s=t.y,u(a,o,s,l),a.stroke()}),t.update()}),t.pulses=t.pulses.filter(function(t){return!t.dead})}M.prototype={angle:0,power:0,dead:!1,cosAngle:0,sinAngle:0,update:function(){this.power-=.03,this.power<=0&&(this.dead=!0)}},x.prototype={origin:null,dest:null,v:0,speed:.03+.05*Math.random(),angle:0,dying:!1,dyingCounter:e.trailSize,dead:!1,lastPos:null,sparkRandom:.2,update:function(t){var e=this;if(void 0===t&&(t=1),this.dying)return this.dyingCounter--,void(this.dyingCounter<=0&&(this.dead=!0));if(this.v>=1){this.dying=!0;var i=Math.round(2.45*Math.random()),n=0,a=[];i>0&&d(i,function(t){var i=e.dest.getRandomNeighbor(e.origin);if(null!=i)if(a.indexOf(i)>-1)n++;else{var o=e.dest.diagram.pulse(e.dest,i);null!=o?(a.push(i),o.speed=e.speed,o.lastPos=e.lastPos.slice(e.lastPos.length-4)):n++}else n++});var o=1+1*Math.random();(0==i||n>=i)&&(this.dest.blip(),l=[this.dest].concat(l.slice(0,20)),this.dest.lightUp(),o=7.5+6*this.dest.depth);var s=this.dest.x-this.origin.x,r=this.dest.y-this.origin.y,h=Math.atan2(r,s);this.dest.forces.push(new M(h,o))}this.v+=this.speed*t,this.v>1&&(this.v=1)},getPos:function(){var t={x:0,y:0};if(this.dying)t=this.lastPos[this.lastPos.length-1];else{var i=this.dest.x-this.origin.x,n=this.dest.y-this.origin.y,a=Math.sqrt(i*i+n*n),o=Math.atan2(n,i);this.angle=o,t={x:this.origin.x+Math.cos(o)*(a*this.v),y:this.origin.y+Math.sin(o)*(a*this.v)};var s=this.sparkRandom;t.x+=-s/2+Math.random()*s,t.y+=-s/2+Math.random()*s}return this.lastPos=this.lastPos.slice(this.lastPos.length-e.trailSize).concat(t),t}},window.addEventListener("resize",function i(){window.removeEventListener("resize",i),h=!0,Pulticles(t,e)}),t.setAttribute("width",s),t.setAttribute("height",r),g=a,(v=function(t,e,i){for(var n=i/2,a=Math.ceil(t/i)+1,o=Math.ceil(3*e/i)+1,s=[],r=[],l=0;l<o;++l)for(var h=0;h<a;++h)s.push({x:(l%4<2?h*i:h*i+i/2)-n,y:Math.floor(l/2)*i+l%2*3*i/4-n}),l>0&&r.push({va:s[l*a+h],vb:s[(l-1)*a+h]}),l>0&&l%4==0&&h>0&&r.push({va:s[l*a+h],vb:s[(l-1)*a+h-1]}),l%4==2&&h<a-1&&r.push({va:s[l*a+h],vb:s[(l-1)*a+h+1]});return{vertices:s,edges:r}}((c=s)/n,(f=r)/n,e.spacing)).width=c/n,v.height=f/n,m(v),function t(e){if(!h){var i=(e-0)/.06;i>1.5&&(i=1.5),P(v,g,c,f,i),requestAnimationFrame(t)}}()});