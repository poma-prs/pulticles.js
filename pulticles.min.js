!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Pulticles=t}}(function(t,e){void 0===e&&(e={}),e=Object.assign({edgeLightUpSpeed:.002,edgeFadeSpeed:.001,edgeLightUpBrightness:.2,eraseAlpha:.5,trailSize:25,pulseChance:.06,maxPulsesPerSpawn:1,maxPulses:10,minVertexRadius:1,minPulseSpeed:.03/2.25,pulseSpeedVariation:.04/2.25,vertexRadiusVariation:1,spacing:80,bg:[71,125,194],fg:[128,198,255]},e);var i=2*Math.PI,n=window.devicePixelRatio,o=t.getContext("2d"),s=t.getBoundingClientRect(),r=s.width*n,a=s.height*n,l=[],h=!1,d=function(t,e){for(var i=0;i<t;i++)e(i)};function u(t,e,o,s){t.beginPath(),t.arc(e*n,o*n,s*n,0,i),t.closePath()}function c(t,e,i,n){u(t,e,i,n),t.fill()}function g(t,e,i){this.r=t,this.g=e,this.b=i}g.prototype={r:0,g:0,b:0,interpolate:function(t,e){var i=t.r-this.r,n=t.g-this.g,o=t.b-this.b;return new g(this.r+i*e,this.g+n*e,this.b+o*e)},toString:function(){return"rgb("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+")"}};var p,f,v,b,y={bg:new g(e.bg[0],e.bg[1],e.bg[2]),fg:new g(e.fg[0],e.fg[1],e.fg[2])},m=function(t){return y.bg.interpolate(y.fg,t).toString()};function x(t){var n;t.pulses=[],t.pulse=function(i,n){var o=new P(i,n);return o.speed=e.minPulseSpeed+e.pulseSpeedVariation*Math.random(),t.pulses.length<e.maxPulses?(t.pulses.push(o),i.diagram.edges.find(function(t){return t.va==i&&t.vb==n||t.vb==i&&t.va==n}).lightUp(),o):null},(n=t).vertices.forEach(function(t){var o,s,r=Math.random();t.diagram=n,t.clockSpeed=.002*Math.random()-.001,t.clock=Math.random()*i,t.originX=t.x,t.originY=t.y,t.clockIntensity=0+0*Math.pow(r,3),t.depth=r,t.radius=e.minVertexRadius+r*e.vertexRadiusVariation,t.color=0,t.colorFadeSpeed=.01,t.blips=[],t.blipSpeed=.04,t.blipRadius=3.5*t.radius+Math.random()*t.radius*1,t.forceStrength=4,t.forces=[],t.neighbors=(o=t,void 0===s&&(s=null),n.edges.filter(function(t){return(t.va==o||t.vb==o)&&t.va!=s&&t.vb!=s}).reduce(function(t,e){return t.concat(e.va,e.vb)},[]).filter(function(t){return t!=o})),t.getRandomNeighbor=function(t){void 0===t&&(t=null);var e=this.neighbors.filter(function(e){return e!=t});if(0==e.length)return null;var i=e[Math.round(Math.random()*(e.length-1))];return i},t.lightUp=function(){this.color=1},t.blip=function(){this.blips.push(1)},t.applyForces=function(){for(var e={x:0,y:0},i=t.forces.length-1;i>=0;i--){var n=t.forces[i],o=Math.pow(n.power,3);e.x+=n.cosAngle*o*n.strength,e.y+=n.sinAngle*o*n.strength,n.update(),n.dead&&t.forces.splice(i,1)}return e},t.update=function(){var t=this;this.color>0&&(this.color-=this.colorFadeSpeed,this.color<0&&(this.color=0)),this.blips=this.blips.map(function(e){return e-=t.blipSpeed}).filter(function(t){return t>0})}}),t.edges.forEach(function(t){t.color=0,t.colorTo=0,t.lightUp=function(){t.colorTo=e.edgeLightUpBrightness,t.color=Math.max(t.color,1e-4)},t.update=function(){t.colorTo>0?(t.color+=e.edgeLightUpSpeed,t.colorTo-=e.edgeLightUpSpeed,t.colorTo<0&&(t.colorTo=0)):t.color>0&&(t.color-=e.edgeFadeSpeed,t.color<0&&(t.color=0))}}),t.outerVertices=t.vertices.filter(function(e){return e.y<=0||e.y>=t.height||e.x<=0||e.x>=t.width})}function M(t,e){this.angle=t,this.power=1,this.strength=e,this.cosAngle=Math.cos(t),this.sinAngle=Math.sin(t)}function P(t,e){this.origin=t,this.dest=e,this.lastPos=[]}function S(t,i,o,s,r){Math.random()<e.pulseChance&&d(Math.random()*e.maxPulsesPerSpawn,function(e){var i=t.outerVertices[Math.round(Math.random()*(t.outerVertices.length-1))],n=i.getRandomNeighbor();if(l.length>0&&(null==n||Math.random()<.1)){if(null==(n=(i=l[Math.round(Math.random()*(l.length-1))]).getRandomNeighbor()))return}else if(null==n)return;if(null!=t.pulse(i,n)){var o=n.x-i.x,s=n.y-i.y;Math.atan2(s,o);Math.PI}}),i.fillStyle=m(0),i.globalAlpha=e.eraseAlpha,i.fillRect(0,0,o,s),i.globalAlpha=1,i.fillStyle=m(.2),i.strokeStyle=m(.15),i.lineCap="round",t.edges.forEach(function(t){t.color<=0||(i.beginPath(),i.moveTo(t.va.x*n,t.va.y*n),i.lineTo(t.vb.x*n,t.vb.y*n),i.strokeStyle=m(t.color),i.globalAlpha=1,i.lineWidth=1*n,i.stroke(),t.update())}),t.pulses.forEach(function(t){t.getPos();if(t.update(r),i.beginPath(),i.moveTo(t.lastPos[0].x*n,t.lastPos[0].y*n),t.lastPos.slice(1).forEach(function(t){i.lineTo(t.x*n,t.y*n)}),i.strokeStyle=m(1),i.globalAlpha=.7,i.lineWidth=1*n,i.stroke(),t.lastPos.length>=2&&!t.dying){i.lineWidth=5*n,i.globalAlpha=.7,i.beginPath();var e=t.lastPos.length-2,o=t.lastPos.length-1;i.moveTo(t.lastPos[e].x*n,t.lastPos[e].y*n),i.lineTo(t.lastPos[o].x*n,t.lastPos[o].y*n),i.strokeStyle=m(1),i.stroke()}}),t.vertices.forEach(function(t){var e=t.applyForces();if(t.x=t.originX+e.x,t.y=t.originY+e.y,t.color>0){var o=t.depth;0;var s=m(0+1*Math.min(1,t.color));i.fillStyle=s,i.globalAlpha=1-.35*(1-o),c(i,t.x,t.y,t.radius)}c(i,t.x,t.y,t.radius),t.blips.forEach(function(e){var o,s,r,a=1-e,l=t.radius+t.blipRadius*Math.pow(a,.5),h=1*e;i.globalAlpha=h,i.lineWidth=1*n,i.strokeStyle=m(1),o=i,s=t.x,r=t.y,u(o,s,r,l),o.stroke()}),t.update()}),t.pulses=t.pulses.filter(function(t){return!t.dead})}M.prototype={angle:0,power:0,dead:!1,cosAngle:0,sinAngle:0,update:function(){this.power-=.03,this.power<=0&&(this.dead=!0)}},P.prototype={origin:null,dest:null,v:0,speed:.03+.05*Math.random(),angle:0,dying:!1,dyingCounter:e.trailSize,dead:!1,lastPos:null,sparkRandom:.2,update:function(t){var e=this;if(void 0===t&&(t=1),this.dying)return this.dyingCounter--,void(this.dyingCounter<=0&&(this.dead=!0));if(this.v>=1){this.dying=!0;var i=Math.round(2.45*Math.random()),n=0,o=[];i>0&&d(i,function(t){var i=e.dest.getRandomNeighbor(e.origin);if(null!=i)if(o.indexOf(i)>-1)n++;else{var s=e.dest.diagram.pulse(e.dest,i);null!=s?(o.push(i),s.speed=e.speed,s.lastPos=e.lastPos.slice(e.lastPos.length-4)):n++}else n++});var s=1+1*Math.random();(0==i||n>=i)&&(this.dest.blip(),l=[this.dest].concat(l.slice(0,20)),s=7.5+6*this.dest.depth);var r=this.dest.x-this.origin.x,a=this.dest.y-this.origin.y,h=Math.atan2(a,r);this.dest.forces.push(new M(h,s))}this.v+=this.speed*t,this.v>1&&(this.v=1)},getPos:function(){var t={x:0,y:0};if(this.dying)t=this.lastPos[this.lastPos.length-1];else{var i=this.dest.x-this.origin.x,n=this.dest.y-this.origin.y,o=Math.sqrt(i*i+n*n),s=Math.atan2(n,i);this.angle=s,t={x:this.origin.x+Math.cos(s)*(o*this.v),y:this.origin.y+Math.sin(s)*(o*this.v)};var r=this.sparkRandom;t.x+=-r/2+Math.random()*r,t.y+=-r/2+Math.random()*r}return this.lastPos=this.lastPos.slice(this.lastPos.length-e.trailSize).concat(t),t}},window.addEventListener("resize",function i(){window.removeEventListener("resize",i),h=!0,Pulticles(t,e)}),t.setAttribute("width",r),t.setAttribute("height",a),p=o,(b=function(t,e,i){for(var n=i/2,o=Math.ceil(t/i)+1,s=Math.ceil(3*e/i)+1,r=[],a=[],l=0;l<s;++l)for(var h=0;h<o;++h)r.push({x:(l%4<2?h*i:h*i+i/2)-n,y:Math.floor(l/2)*i+l%2*3*i/4-n}),l>0&&a.push({va:r[l*o+h],vb:r[(l-1)*o+h]}),l>0&&l%4==0&&h>0&&a.push({va:r[l*o+h],vb:r[(l-1)*o+h-1]}),l%4==2&&h<o-1&&a.push({va:r[l*o+h],vb:r[(l-1)*o+h+1]});return{vertices:r,edges:a}}((f=r)/n,(v=a)/n,e.spacing)).width=f/n,b.height=v/n,x(b),function t(e){if(!h){var i=(e-0)/.06;i>1.5&&(i=1.5),S(b,p,f,v,i),requestAnimationFrame(t)}}()});